<div class="container py-4">

  <!-- Titre -->
  <div class="mb-4">
    <h2 class="fw-bold">{{ 'DashboardSection.Title' | translate }}</h2>
    <p class="text-muted">{{ 'DashboardSection.Description' | translate }}</p>
  </div>

  <!-- KPIs -->
  <div class="row g-4 mb-4">

    <!-- Total utilisateurs -->
    <div class="col-md-3">
      <div class="stat-card p-3 border rounded shadow-sm h-100">
        <div class="d-flex justify-content-between">
          <h6 class="text-muted">{{ 'DashboardSection.Users' | translate }}</h6>
          <i class="bi bi-people fs-4 text-primary"></i>
        </div>
          <h3 class="fw-bold">{{ totalUsers }}</h3>

          <ul class="list-unstyled small mt-2">
            <li>
              <strong>{{ 'DashboardSection.Weekly' | translate }} :</strong>
              {{ numberUserWeeklyTrend }}
              <span [class.text-success]="percentageUserWeeklyTrend >= 0"
                    [class.text-danger]="percentageUserWeeklyTrend < 0">
                ({{ percentageUserWeeklyTrend >= 0 ? '+' : '' }}{{ percentageUserWeeklyTrend }}%)
              </span>
            </li>

            <li>
              <strong>{{ 'DashboardSection.Month' | translate }} :</strong>
              {{ numberUserMonthlyTrend }}
              <span [class.text-success]="percentageUserMonthlyTrend >= 0"
                    [class.text-danger]="percentageUserMonthlyTrend < 0">
                ({{ percentageUserMonthlyTrend >= 0 ? '+' : '' }}{{ percentageUserMonthlyTrend }}%)
              </span>
            </li>

            <li>
              <strong>{{ 'DashboardSection.Year' | translate }} :</strong>
              {{ numberUserYearlyTrend }}
              <span [class.text-success]="percentageUserYearlyTrend >= 0"
                    [class.text-danger]="percentageUserYearlyTrend < 0">
                ({{ percentageUserYearlyTrend >= 0 ? '+' : '' }}{{ percentageUserYearlyTrend }}%)
              </span>
            </li>
          </ul>
      </div>
    </div>

    <!-- Utilisateurs actifs -->
    <div class="col-md-3">
      <div class="stat-card p-3 border rounded shadow-sm h-100">
        <div class="d-flex justify-content-between">
          <h6 class="text-muted">{{ 'DashboardSection.UserActive' | translate }}</h6>
          <i class="bi bi-check-circle fs-4 text-success"></i>
        </div>
        <h3 class="fw-bold">{{ activeUsers }}</h3>
        <small class="text-muted">{{ activeRate }}% {{ 'DashboardSection.FromUsers' | translate }}</small>
      </div>
    </div>

    <!-- Rôles -->
    <div class="col-md-3">
      <div class="stat-card p-3 border rounded shadow-sm h-100">
        <div class="d-flex justify-content-between">
          <h6 class="text-muted">{{ 'DashboardSection.Roles' | translate }}</h6>
          <i class="bi bi-shield-lock fs-4 text-warning"></i>
        </div>
        <h3 class="fw-bold">{{ totalRoles }}</h3>
        <small class="text-muted">{{ 'DashboardSection.ProfilesAvailable' | translate }}</small>
      </div>
    </div>

    <!-- Critères -->
    <div class="col-md-3">
      <div class="stat-card p-3 border rounded shadow-sm h-100" style="cursor:pointer;" (click)="openCriteresModule()">
        <div class="d-flex justify-content-between">
          <h6 class="text-muted">{{ 'DashboardSection.Criterias' | translate }}</h6>
          <i class="bi bi-star-half fs-4 text-info"></i>
        </div>
        <h3 class="fw-bold">{{ totalCriteria }}</h3>
        <small class="text-muted">
          <span *ngFor="let item of criteriaPerStar; let last = last">
            {{ item.label }}&nbsp;({{ item.count }})<span *ngIf="!last"> · </span>
          </span>
        </small>
      </div>
    </div>

  </div>

  <!-- Deux colonnes principales -->
  <div class="row g-4">

    <!-- Activité récente -->
  <div class="col-md-6">
    <div class="p-4 border rounded shadow-sm h-100">
      <h4 class="fw-bold mb-3">
        <i class="bi bi-clock-history me-2"></i>Activité récente
      </h4>

      <!-- WRAPPER SCROLLABLE -->
      <div class="activity-scroll">
        <ul class="list-group small">
          <li *ngFor="let activity of recentActivities" class="list-group-item">
            <div class="fw-bold">
              {{ activity.description }}
            </div>
            <div class="text-muted">
              {{ activity.date | date:'dd/MM/yyyy HH:mm' }}
              — {{ 'ActivitySection.From' | translate }} {{ activity.user.firstName }} {{ activity.user.lastName }}
            </div>
          </li>

          <li *ngIf="recentActivities.length === 0" class="list-group-item text-muted">
            {{ 'ActivitySection.NoActivity' | translate }}
          </li>
        </ul>
      </div>

      <button type="button" class="btn btn-primary w-100 mt-3" (click)="openActivityDetails()">
        <i class="bi bi-clock-history me-2"></i>
        {{ 'ActivitySection.Details' | translate }}
      </button>
    </div>
  </div>

  <!-- Mini‑graphique (sans librairie externe) -->
  <div class="col-md-6">
    <div class="p-4 border rounded shadow-sm h-100">
      <h4 class="fw-bold mb-3">
        <i class="bi bi-graph-up-arrow me-2"></i>{{ 'ActivitySection.UserEvolution' | translate }}
      </h4>
      <canvas #usersChart width="600" height="200" style="width: 100%;"></canvas>
      <p class="text-muted small mt-3">
        {{ 'ActivitySection.Variation' | translate }}
      </p>
    </div>
  </div>

  </div>

</div>
