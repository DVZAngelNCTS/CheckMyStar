<form [formGroup]="form" class="d-flex flex-row gap-2">
  <!-- ========== COLONNE INFORMATIONS ========== -->
  <div class="flex-grow-1 d-flex flex-column column-box">
    <h5 class="fw-bold mb-3">{{ 'UserSection.Informations' | translate }}</h5>

    <!-- IDENTIFIER -->
    <app-field controlName="identifier" label="{{ 'UserSection.Identifier' | translate }}" labelClass="w-10rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-list-ol">
      <input type="text" digitsOnly class="form-control" formControlName="identifier" [readonly]="readonlyIdentifier" required>
    </app-field>

    <!-- CIVILITY + ACTIVE -->
    <app-field controlName="civility" label="{{ 'UserSection.Civility' | translate }}" labelClass="w-10rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-gender-ambiguous">
      <select class="form-select" formControlName="civility">
        <option [value]="EnumCivility.Mister">{{ 'UserSection.Mister' | translate }}</option>
        <option [value]="EnumCivility.Madam">{{ 'UserSection.Madam' | translate }}</option>
      </select>
    </app-field>

    <app-field controlName="isActive" label="{{ 'UserSection.Active' | translate }}" labelClass="w-10rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-shield-check">
      <select class="form-select" formControlName="isActive">
        <option [value]="true">{{ 'CommonSection.Yes' | translate }}</option>
        <option [value]="false">{{ 'CommonSection.No' | translate }}</option>
      </select>
    </app-field>

    <!-- LAST NAME + FIRST NAME -->
     <app-field controlName="lastName" label="{{ 'UserSection.LastName' | translate }}" labelClass="w-10rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-person">
        <input type="text" class="form-control" formControlName="lastName" required>
      </app-field>

      <app-field controlName="firstName" label="{{ 'UserSection.FirstName' | translate }}" labelClass="w-10rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-person">
        <input type="text" class="form-control" formControlName="firstName" required>
      </app-field>

    <!-- SOCIETY -->
    <app-field controlName="societyIdentifier" label="{{ 'UserSection.Society' | translate }}" labelClass="w-10rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-building">
      <div class="input-group">
        <select class="form-select" formControlName="societyIdentifier" (change)="onSocietyChange($event)">
          <option *ngFor="let society of societies" [value]="society.identifier">
            {{ society.name }}
          </option>
        </select>
        <button type="button" class="btn btn-outline-secondary" (click)="onCreateSocietyClick()">
          <i class="bi bi-plus-lg"></i>
        </button>
      </div>
    </app-field>

    <!-- EMAIL -->
    <app-field controlName="email" label="{{ 'UserSection.Email' | translate }}" labelClass="w-10rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-envelope-at">
      <input type="text" class="form-control" formControlName="email" required>
    </app-field>

    <!-- PHONE + ROLE sur la même ligne -->
     <app-field controlName="phone" label="{{ 'UserSection.Phone' | translate }}" labelClass="w-10rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-telephone">
        <input type="text" class="form-control" formControlName="phone">
      </app-field>

      <app-field controlName="role" label="{{ 'RoleSection.Role' | translate }}" labelClass="w-10rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-shield ">
        <select class="form-select" formControlName="role">
          <option [value]="EnumRole.Administrator">{{ 'RoleSection.Administrator' | translate }}</option>
          <option [value]="EnumRole.User">{{ 'RoleSection.User' | translate }}</option>
          <option [value]="EnumRole.Inspector">{{ 'RoleSection.Inspector' | translate }}</option>
        </select>
      </app-field>

    <!-- PASSWORD -->
    <app-field controlName="password" label="{{ 'UserSection.Password' | translate }}" labelClass="w-10rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-lock">
      <div class="input-group">
        <input [type]="passwordVisible ? 'text' : 'password'" class="form-control" formControlName="password">
        <button type="button" class="btn btn-outline-secondary" (click)="togglePasswordVisibility()">
          <i class="bi" [ngClass]="passwordVisible ? 'bi-eye-slash' : 'bi-eye'"></i>
        </button>
        <button type="button" class="btn btn-outline-secondary" (click)="generatePassword()"> 
          <i class="bi bi-magic"></i>
        </button>        
      </div>
      <div class="invalid-feedback d-block" *ngIf="form.get('password')?.errors?.['weakPassword']">
         {{ 'UserSection.PasswordValidate' | translate }}
      </div>      
    </app-field>
  </div>

  <!-- ========== COLONNE ADRESSE ========== -->
  <div class="flex-grow-1 d-flex flex-column column-box" formGroupName="address">
    <h5 class="fw-bold mb-3">{{ 'UserSection.Address' | translate }}</h5>

    <!-- SEARCH ADDRESS -->
    <app-address-autocomplete (addressSelected)="onAddressSelected($event)"></app-address-autocomplete>

    <!-- IDENTIFIER + NUMBER sur la même ligne -->
    <app-field controlName="address.identifier" label="{{ 'AddressSection.Identifier' | translate }}" labelClass="w-8rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-list-ol">
      <input type="text" digitsOnly class="form-control" formControlName="identifier" [readonly]="readonlyIdentifier" required>
    </app-field>

    <!-- NUMBER -->
    <app-field controlName="number" label="{{ 'AddressSection.Number' | translate }}" labelClass="w-8rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-1-square">
      <input type="text" class="form-control" formControlName="number">
    </app-field>

    <!-- ADDRESS LINE -->
    <app-field controlName="addressLine" label="{{ 'AddressSection.AddressLine' | translate }}" labelClass="w-8rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-geo-alt">
      <input type="text" class="form-control" formControlName="addressLine">
    </app-field>

    <!-- CITY + ZIP CODE -->
    <app-field controlName="city" label="{{ 'AddressSection.City' | translate }}" labelClass="w-8rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-building">
      <input type="text" class="form-control" formControlName="city">
    </app-field>

    <app-field controlName="zipCode" label="{{ 'AddressSection.ZipCode' | translate }}" labelClass="w-8rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-mailbox">
      <input type="text" class="form-control" formControlName="zipCode">
    </app-field>

    <!-- REGION -->
    <app-field controlName="region" label="{{ 'AddressSection.Region' | translate }}" labelClass="w-8rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-geo">
      <input type="text" class="form-control" formControlName="region">
    </app-field>

    <!-- COUNTRY -->
    <div formGroupName="country">
      <app-field controlName="identifier" label="{{ 'AddressSection.Country' | translate }}" labelClass="w-8rem start fw-bold" labelTextPosition="start" controlClass="w-100" icon="bi bi-globe">
        <select class="form-select" formControlName="identifier" (change)="onCountryChange($event)">
          <option *ngFor="let c of countries" [value]="c.identifier"> {{ c.name }} </option>
        </select>
      </app-field>
    </div>
  </div>
</form>
