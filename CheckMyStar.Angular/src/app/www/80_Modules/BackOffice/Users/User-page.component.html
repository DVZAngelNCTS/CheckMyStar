<div class="d-flex flex-column flex-grow-1">
  <!-- Filtres -->
  <div class="d-flex flex-row">
    <div class="d-flex flex-column rounded p-4 flex-grow-1 bg-secondary-light">
      <app-user-filter [loadingSearch]="loadingSearch" [loadingReset]="loadingReset" [societies]="societies" (filter)="onFilter($event)"></app-user-filter>
    </div>
  </div>

  <!-- Contenu principal extensible -->
  <div class="d-flex flex-column flex-grow-1">
    <!-- Tableau extensible -->
    <div class="d-flex flex-column flex-grow-1">
      <div class="d-flex flex-column rounded p-4 flex-grow-1 overflow-auto bg-secondary-light">
        <app-table [columns]="columns" [data]="users!" (update)="openUpdate($event)" (delete)="openDelete($event)" (enabled)="toggleEnabled($event)" [showDetail]="false" (openCreate)="openCreate()"></app-table>
      </div>
    </div>
  </div>
</div>

<app-popup [large]="true" [visible]="popupVisible" [title]="popupTitle" [confirmLabel]="popupConfirmLabel" [cancelLabel]="popupCancelLabel" [errorMessage]="popupError" [loading]="loading" (confirm)="onPopupConfirm()" (cancel)="onPopupCancel()">
  <!-- Contenu dynamique -->
  <ng-container *ngIf="popupMode === 'delete'">
    <p>{{ 'UserSection.DeleteAsk' | translate }} <strong>{{ selectedUser?.lastName }} {{ selectedUser?.firstName }}</strong> ?</p>
  </ng-container>

  <ng-container *ngIf="popupVisible">
    <ng-container *ngIf="popupMode === 'edit'">
      <app-user-form [user]="selectedUser" [readonlyIdentifier]="true" (createSociety)="openCreateSociety()"></app-user-form>
    </ng-container>
    <ng-container *ngIf="popupMode === 'create'">
      <app-user-form [readonlyIdentifier]="true" (createSociety)="openCreateSociety()"></app-user-form>
    </ng-container>
  </ng-container>

  <ng-container *ngIf="popupMode === 'createSociety'">
    <form [formGroup]="societyForm" class="d-flex flex-column gap-2">
      <!-- NAME (pleine largeur) -->
      <div class="form-group">
        <label>{{ 'SocietySection.Name' | translate }}</label>
        <input type="text" class="form-control" formControlName="name" required>
      </div>
      <!-- EMAIL + PHONE sur la même ligne -->
      <div class="row g-2">
        <div class="col-6">
          <div class="form-group">
            <label>{{ 'SocietySection.Email' | translate }}</label>
            <input type="email" class="form-control" formControlName="email">
          </div>
        </div>
        <div class="col-6">
          <div class="form-group">
            <label>{{ 'SocietySection.Phone' | translate }}</label>
            <input type="text" class="form-control" formControlName="phone">
          </div>
        </div>
      </div>
      <div class="border-top pt-2" formGroupName="address">
        <!-- NUMBER + ZIP CODE sur la même ligne -->
        <div class="row g-2">
          <div class="col-6">
            <div class="form-group">
              <label>{{ 'AddressSection.Number' | translate }}</label>
              <input type="text" class="form-control" formControlName="number">
            </div>
          </div>
          <div class="col-6">
            <div class="form-group">
              <label>{{ 'AddressSection.ZipCode' | translate }}</label>
              <input type="text" class="form-control" formControlName="zipCode" required>
            </div>
          </div>
        </div>
        <!-- ADDRESS LINE (pleine largeur) -->
        <div class="form-group">
          <label>{{ 'AddressSection.AddressLine' | translate }}</label>
          <input type="text" class="form-control" formControlName="addressLine" required>
        </div>
        <!-- CITY + REGION sur la même ligne -->
        <div class="row g-2">
          <div class="col-6">
            <div class="form-group">
              <label>{{ 'AddressSection.City' | translate }}</label>
              <input type="text" class="form-control" formControlName="city" required>
            </div>
          </div>
          <div class="col-6">
            <div class="form-group">
              <label>{{ 'AddressSection.Region' | translate }}</label>
              <input type="text" class="form-control" formControlName="region">
            </div>
          </div>
        </div>
        <!-- COUNTRY (pleine largeur) -->
        <div class="form-group">
          <label>{{ 'AddressSection.Country' | translate }}</label>
          <select class="form-select" formControlName="countryIdentifier" required>
            <option *ngFor="let c of countries" [value]="c.identifier">{{ c.name }}</option>
          </select>
        </div>
      </div>
    </form>
  </ng-container>
</app-popup>

