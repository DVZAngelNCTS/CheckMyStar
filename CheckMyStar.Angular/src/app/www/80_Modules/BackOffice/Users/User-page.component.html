<div class="d-flex flex-column flex-grow-1">
  <!-- Filtres -->
  <div class="d-flex flex-row">
    <div class="d-flex flex-column rounded p-4 flex-grow-1 bg-secondary-light">
      <app-user-filter [loadingSearch]="loadingSearch" [loadingReset]="loadingReset" [societies]="societies" (filter)="onFilter($event)"></app-user-filter>
    </div>
  </div>

  <!-- Contenu principal extensible -->
  <div class="d-flex flex-column flex-grow-1">
    <!-- Tableau extensible -->
    <div class="d-flex flex-column flex-grow-1">
      <div class="d-flex flex-column rounded p-4 flex-grow-1 overflow-auto bg-secondary-light">
        <app-table [columns]="columns" [data]="users!" (update)="openUpdate($event)" (delete)="openDelete($event)" (enabled)="toggleEnabled($event)"></app-table>
      </div>
    </div>

    <!-- Bouton Ajouter -->
    <div class="d-flex flex-row border-top">
      <div class="d-flex flex-column p-4 flex-grow-1 bg-secondary-light">
        <div class="ms-auto">
          <button type="button" class="btn btn-secondary w-9rem" (click)="openCreate()">
            <i class="bi bi-plus-lg me-2"></i>
            {{ 'CommonSection.Add' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<app-popup class="popup-large" [visible]="popupVisible" [title]="popupTitle" [confirmLabel]="popupConfirmLabel" [cancelLabel]="popupCancelLabel" [errorMessage]="popupError" [loading]="loading" (confirm)="onPopupConfirm()" (cancel)="onPopupCancel()">
  <!-- Contenu dynamique -->
  <ng-container *ngIf="popupMode === 'delete'">
    <p>{{ 'UserSection.DeleteAsk' | translate }} <strong>{{ selectedUser?.lastName }} {{ selectedUser?.firstName }}</strong> ?</p>
  </ng-container>

  <ng-container *ngIf="popupVisible">
    <ng-container *ngIf="popupMode === 'edit'">
      <app-user-form [user]="selectedUser" [readonlyIdentifier]="true" (createSociety)="openCreateSociety()"></app-user-form>
    </ng-container>
    <ng-container *ngIf="popupMode === 'create'">
      <app-user-form [readonlyIdentifier]="true" (createSociety)="openCreateSociety()"></app-user-form>
    </ng-container>
  </ng-container>

  <ng-container *ngIf="popupMode === 'createSociety'">
    <form [formGroup]="societyForm" class="d-flex flex-column gap-3">
      <div class="form-group">
        <label>{{ 'SocietySection.Name' | translate }}</label>
        <input type="text" class="form-control" formControlName="name" required>
      </div>
      <div class="form-group">
        <label>{{ 'SocietySection.Email' | translate }}</label>
        <input type="email" class="form-control" formControlName="email">
      </div>
      <div class="form-group">
        <label>{{ 'SocietySection.Phone' | translate }}</label>
        <input type="text" class="form-control" formControlName="phone">
      </div>
      <div class="border-top pt-3" formGroupName="address">
        <div class="form-group">
          <label>{{ 'AddressSection.Number' | translate }}</label>
          <input type="text" class="form-control" formControlName="number">
        </div>
        <div class="form-group">
          <label>{{ 'AddressSection.AddressLine' | translate }}</label>
          <input type="text" class="form-control" formControlName="addressLine" required>
        </div>
        <div class="form-group">
          <label>{{ 'AddressSection.City' | translate }}</label>
          <input type="text" class="form-control" formControlName="city" required>
        </div>
        <div class="form-group">
          <label>{{ 'AddressSection.ZipCode' | translate }}</label>
          <input type="text" class="form-control" formControlName="zipCode" required>
        </div>
        <div class="form-group">
          <label>{{ 'AddressSection.Region' | translate }}</label>
          <input type="text" class="form-control" formControlName="region">
        </div>
        <div class="form-group">
          <label>{{ 'AddressSection.Country' | translate }}</label>
          <select class="form-select" formControlName="countryIdentifier" required>
            <option *ngFor="let c of countries" [value]="c.identifier">{{ c.name }}</option>
          </select>
        </div>
      </div>
    </form>
  </ng-container>
</app-popup>

