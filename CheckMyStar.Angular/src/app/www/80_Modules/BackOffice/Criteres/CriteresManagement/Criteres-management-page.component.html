<div class="mt-4">
  <div class="d-flex flex-column flex-grow-1">
    <div class="d-flex flex-column rounded p-4 bg-secondary-light criteres-scroll">
      
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
        <div class="d-flex align-items-center gap-2">
          <h5 class="mb-0">
            {{ 'CriteresSection.Management' | translate }} – {{ selectedStar?.label }}
            <span class="badge bg-success ms-2">
              <span *ngFor="let i of [1,2,3,4,5]" [class.opacity-25]="i > (selectedStar?.rating || 0)">⭐</span>
            </span>
          </h5>
        </div>
      </div>

      <!-- Filtres -->
      <app-criteres-filter 
        (filter)="onFilter($event)" 
        (add)="onAdd()"
        [loadingSearch]="loadingSearch" 
        [loadingReset]="loadingReset">
      </app-criteres-filter>

      <!-- Tableau avec app-table -->
      <div class="mt-3">
        <app-table 
          [data]="filteredCriteria" 
          [columns]="columns"
          (delete)="onDelete($event)"
          (update)="onEdit($event)"
          (openCreate)="onAdd()"
          [showDetail]="false"> 
        </app-table>

        <div *ngIf="filteredCriteria.length === 0" class="text-center text-muted py-4">
          <i class="bi bi-inbox fs-1"></i>
          <p class="mt-2">{{ 'CommonSection.NoResults' | translate }}</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- POPUP -->
<app-popup 
  [visible]="showPopup" 
  [title]="popupTitle" 
  [confirmLabel]="popupConfirmLabel" 
  [cancelLabel]="popupCancelLabel" 
  [errorMessage]="popupError" 
  [loading]="loading" 
  (confirm)="onSavePopup()" 
  (cancel)="closePopup()"
  icon="bi bi-star">
  
  <!-- Mode DELETE -->
  <ng-container *ngIf="popupMode === 'delete'">
    <p>{{ 'CriteresSection.DeleteAsk' | translate }} <strong>{{ currentCriterion?.description }}</strong> ?</p>
  </ng-container>

  <!-- Mode CREATE ou EDIT -->
  <ng-container *ngIf="popupMode === 'create' || popupMode === 'edit'">
    <app-criteres-form 
      [criterion]="currentCriterion" 
      [readonlyIdentifier]="popupMode === 'edit'">
    </app-criteres-form>
  </ng-container>
</app-popup>